generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  student
  employer
  admin
}

enum JobType {
  full_time
  part_time
  internship
}

enum JobStatus {
  active
  closed
  draft
}

enum CandidateStatus {
  new
  screening
  interview
  hired
  rejected
}

enum ApplicationStatus {
  pending
  reviewed
  accepted
  rejected
}

enum CourseLevel {
  beginner
  intermediate
  advanced
}

model Profile {
  id           String    @id @default(uuid())
  clerkUserId  String?   @unique @map("clerk_user_id")
  email        String
  name         String
  role         UserRole  @default(student)
  avatarUrl    String?   @map("avatar_url")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  jobs          Job[]
  candidates    Candidate[]
  activityLogs  ActivityLog[]

  @@map("profiles")
}

model Job {
  id           String     @id @default(uuid())
  employerId   String     @map("employer_id")
  title        String
  company      String
  location     String?
  description  String?
  requirements String[]   @default([]) @map("requirements")
  skills       String[]   @default([]) @map("skills")
  salaryMin    Int?       @map("salary_min")
  salaryMax    Int?       @map("salary_max")
  jobType      JobType    @default(full_time) @map("job_type")
  status       JobStatus  @default(active)
  postedAt     DateTime?  @map("posted_at")
  createdAt    DateTime   @default(now()) @map("created_at")

  employer     Profile        @relation(fields: [employerId], references: [id], onDelete: Cascade)
  applications Application[]

  @@map("jobs")
}

model Candidate {
  id           String          @id @default(uuid())
  userId       String?         @map("user_id")
  clerkUserId  String?         @unique @map("clerk_user_id")
  name         String
  email        String
  role         String?
  skills       Json            @default("[]") @map("skills")
  education    Json            @default("[]") @map("education")
  experience   Json            @default("[]") @map("experience")
  resumeUrl    String?         @map("resume_url")
  resumeText   String?         @map("resume_text")
  matchScore  Int             @default(0) @map("match_score")
  status       CandidateStatus @default(new)
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")

  user          Profile?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  applications  Application[]

  @@map("candidates")
}

model Application {
  id          String            @id @default(uuid())
  jobId       String            @map("job_id")
  candidateId String            @map("candidate_id")
  status      ApplicationStatus @default(pending)
  appliedAt   DateTime          @default(now()) @map("applied_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")

  job         Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@unique([jobId, candidateId])
  @@map("applications")
}

model Course {
  id          String        @id @default(uuid())
  title       String
  description String?
  provider    String?
  url         String?
  skills      String[]      @default([]) @map("skills")
  duration    String?
  level       CourseLevel?
  rating      Decimal?      @db.Decimal(3,2)
  imageUrl    String?       @map("image_url")
  createdAt   DateTime      @default(now()) @map("created_at")

  @@map("courses")
}

model ActivityLog {
  id          String   @id @default(uuid())
  userId      String?  @map("user_id")
  clerkUserId String?  @map("clerk_user_id")
  action      String
  details     String?
  metadata    Json     @default("{}") @map("metadata")
  timestamp   DateTime @default(now()) @map("timestamp")

  user        Profile? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("activity_logs")
}
